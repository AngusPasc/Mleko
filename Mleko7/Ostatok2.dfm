inherited fmOstatok2: TfmOstatok2
  Left = 250
  Top = 437
  Width = 1432
  Height = 443
  ActiveControl = RxDBGrid1
  Caption = #1054#1089#1090#1072#1090#1086#1082
  OldCreateOrder = True
  Position = poScreenCenter
  PixelsPerInch = 96
  TextHeight = 13
  object paBottom: TPanel [0]
    Left = 0
    Top = 374
    Width = 1416
    Height = 30
    Align = alBottom
    TabOrder = 2
    object SpeedButton1: TSpeedButton
      Left = 296
      Top = 3
      Width = 33
      Height = 22
      Action = ActionFind
      Glyph.Data = {
        36040000424D3604000000000000360000002800000010000000100000000100
        2000000000000004000000000000000000000000000000000000FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF000000320500066492000765A000002234FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF0000036467003DDBFE0058EDFF0136C4F4FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00000043200024BAF00056EDFF0066F5FF1E69E9FEFF00FF00FF00
        FF00FF00FF00FF00FF00000033020000090700000403FF00FF00FF00FF00FF00
        FF000000560B001398D1005BEFFF0066F5FF0C6BF5FF2038B1E3FF00FF00FF00
        FF0000002E070004476D001B99CF002EB6E7001B96D501064F840000080E0000
        3D0D001391C2005FF0FF0066F5FF0B66F0FF10249ACE00002A1AFF00FF000000
        460A00138EC00558E7FE3E71D8FF587ED0FF1F65E1FF0360EFFF0C219ADB0011
        92D5005EEFFF0468F5FF1C5BDDFC080E6A9400002C0AFF00FF0000001E02000B
        759C1460E4FFCCB8ADFFFBCD9BFFF6D1A3FFE9D4ACFF6D8ECAFF0C69F3FF235B
        E0FF1A65E8FD162B9DCD02035B3B00002A01FF00FF00FF00FF0000013F2C0244
        D6F8B9AAAFFFF9CF9EFFF0D4A8FFE6D9B1FFDDDDBBFFD2E1C5FF2D70DEFF246B
        E9FF0304436C00001C04FF00FF00FF00FF00FF00FF00FF00FF00020557762165
        E3FFF3D6ADFFEAD6AEFFE0DBB7FFD7E0C1FFD3E6CCFFF2F8E2FF89B4DCFF1571
        F6FF0B126297FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00091275AE3272
        E1FFFDF7D3FFF4F0CFFFD7E4C9FFD3EBD4FFF9FBEAFFFFFEF3FFA5CCEBFF1471
        F7FF141F81C000000901FF00FF00FF00FF00FF00FF00FF00FF00070B6A8F296F
        E8FFF7F6D9FFFFFCE3FFFEFEEBFFFEFFF2FFFFFFF7FFFFFFFCFF79ADEAFF1B77
        F7FF111976AB00000701FF00FF00FF00FF00FF00FF00FF00FF00020360402065
        E6FDA9C3DBFFFFFFF1FFFFFFF6FFFFFFFBFFFFFFFEFFEFF6FCFF1A6AEBFF3F84
        F0FF0305495CFF00FF00FF00FF00FF00FF00FF00FF00FF00FF00000036041728
        9BC71E71F0FFACCEEBFFF5FBFBFFFBFCFEFFDCEDF9FF3C7FE8FF1E78F7FF2B44
        B4E60000250EFF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF000001
        52212E4DC3ED2076F5FF1668ECFF1A61E7FF0A65F0FF2A80F8FF4066D1F50102
        333FFF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF0001014321172397BE416CDAF8487EE7FD4877E0FB1C2C9BCD01014435FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF0000004C0200014A1F02038B3D0101552900002803FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00}
    end
    object bbOk: TBitBtn
      Left = 344
      Top = 3
      Width = 75
      Height = 25
      Caption = #1054#1050
      TabOrder = 0
      OnClick = bbOkClick
      Kind = bkOK
    end
    object bbCancel: TBitBtn
      Left = 440
      Top = 3
      Width = 75
      Height = 25
      Caption = #1054#1090#1084#1077#1085#1072
      TabOrder = 1
      Kind = bkCancel
    end
    object Button1: TButton
      Left = 552
      Top = 3
      Width = 149
      Height = 25
      Caption = #1055#1077#1088#1077#1089#1095#1080#1090#1072#1090#1100' '#1074#1093#1086#1076#1085#1099#1077' '#1094#1077#1085#1099
      TabOrder = 2
      OnClick = Button1Click
    end
    object Button2: TButton
      Left = 3
      Top = 2
      Width = 262
      Height = 25
      Caption = #1055#1077#1088#1077#1089#1095#1077#1090' '#1086#1089#1090#1072#1090#1082#1086#1074' '#1080' '#1082#1086#1088#1088#1077#1082#1094#1080#1103' '#1086#1096#1080#1073#1086#1082
      TabOrder = 3
      OnClick = Button2Click
    end
    object bHistoryChangePriceAll: TButton
      Left = 709
      Top = 5
      Width = 172
      Height = 25
      Caption = #1048#1089#1090#1086#1088#1080#1103' '#1080#1079#1084#1077#1085#1077#1084#1080#1103' '#1094#1077#1085' '#1087#1086#1083#1085#1072#1103
      TabOrder = 4
      OnClick = bHistoryChangePriceAllClick
    end
    object bHistoryPriceForTovar: TButton
      Left = 886
      Top = 5
      Width = 190
      Height = 25
      Caption = #1048#1089#1090#1086#1088#1080#1103' '#1080#1079#1084#1077#1085#1077#1085#1080#1103' '#1094#1077#1085' '#1087#1086' '#1090#1086#1074#1072#1088#1091
      TabOrder = 5
      OnClick = bHistoryPriceForTovarClick
    end
  end
  object RxDBGrid1: TRxDBGrid [1]
    Left = 0
    Top = 23
    Width = 1416
    Height = 351
    Align = alClient
    DataSource = dsOstatok
    FixedColor = clMenu
    Options = [dgEditing, dgTitles, dgIndicator, dgColLines, dgRowLines, dgAlwaysShowSelection, dgConfirmDelete, dgCancelOnExit, dgMultiSelect]
    TabOrder = 1
    TitleFont.Charset = DEFAULT_CHARSET
    TitleFont.Color = clWindowText
    TitleFont.Height = -11
    TitleFont.Name = 'MS Sans Serif'
    TitleFont.Style = []
    OnDrawColumnCell = RxDBGrid1DrawColumnCell
    OnDblClick = RxDBGrid1DblClick
    OnKeyDown = RxDBGrid1KeyDown
    OnKeyPress = RxDBGrid1KeyPress
    ClearSelection = False
    MultiSelect = True
    TitleButtons = True
    OnCheckButton = RxDBGrid1CheckButton
    OnTitleBtnClick = RxDBGrid1TitleBtnClick
    Columns = <
      item
        Expanded = False
        FieldName = 'NameTovar'
        ReadOnly = True
        Title.Caption = #1053#1072#1080#1084#1077#1085#1086#1074#1072#1085#1080#1077
        Width = 187
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Kol'
        Title.Caption = #1050#1086#1083'-'#1074#1086
        Width = 44
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price'
        Title.Caption = #1062#1077#1085#1072'1'
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Percent1'
        Title.Caption = '&'
        Width = 26
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price1'
        Title.Caption = #1062#1077#1085#1072'2'
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Percent2'
        Title.Caption = '&'
        Width = 26
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price2'
        Title.Caption = #1062#1077#1085#1072'3'
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price3'
        Title.Caption = #1062#1077#1085#1072'4'
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price4'
        Title.Caption = #1062#1077#1085#1072'5'
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price5'
        Title.Caption = #1061#1072#1088#1090#1086#1088#1075
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price6'
        Title.Caption = #1056#1077#1075#1080#1086#1085'1'
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price7'
        Title.Caption = #1056#1077#1075#1080#1086#1085'2'
        Width = 45
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'NameCompany'
        Title.Caption = #1055#1088#1086#1080#1079#1074#1086#1076#1080#1090#1077#1083#1100
        Width = 103
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price8'
        Title.Caption = #1060#1086#1079#1079#1080
        Width = 49
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price13'
        Title.Caption = #1040#1058#1041
        Width = 50
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price14'
        Title.Caption = #1053#1086#1074#1072#1103'2'
        Width = 50
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price15'
        Title.Caption = #1053#1086#1074#1072#1103'3'
        Width = 50
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price9'
        Title.Caption = #1052#1086#1088#1086#1079#1086#1074#1099
        Width = 50
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'Price10'
        Title.Caption = #1053#1086#1074#1072#1103'4'
        Width = 50
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'LastPriceIn'
        Title.Caption = #1042#1093'. '#1094#1077#1085#1072
        Width = 53
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'NameEnableSkidka'
        Font.Charset = DEFAULT_CHARSET
        Font.Color = clWindowText
        Font.Height = -11
        Font.Name = 'MS Sans Serif'
        Font.Style = [fsBold]
        Title.Caption = #1057#1082
        Width = 20
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'AVGPriceIn'
        Title.Caption = #1057#1088'.'#1074#1093'.'#1094#1077#1085#1072
        Width = 60
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'PriceForVeb'
        Title.Caption = #1062#1077#1085#1072' '#1089#1072#1081#1090#1072
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'PriceOld'
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'PriceInInst'
        Title.Caption = #1062#1077#1085#1072' '#1074#1093'. '#1091#1089#1090#1085#1086#1074#1083'.'
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'TovarNo'
        ReadOnly = True
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'PriceValidDate'
        ReadOnly = True
        Visible = True
      end
      item
        Expanded = False
        FieldName = 'CurrencyCode'
        Title.Alignment = taCenter
        Visible = True
      end>
  end
  object Panel1: TPanel [2]
    Left = 0
    Top = 0
    Width = 1416
    Height = 23
    Align = alTop
    BevelInner = bvLowered
    BorderWidth = 1
    TabOrder = 0
    object cbAll: TCheckBox
      Left = 5
      Top = 3
      Width = 97
      Height = 17
      Caption = #1057' '#1085#1091#1083#1077#1074#1099#1084#1080
      TabOrder = 0
      OnClick = cbAllClick
    end
  end
  object quOstatok: TMSQuery
    Connection = dmDataModule.DB
    SQL.Strings = (
      'select   Ostatok.TovarNo'
      '       , Ostatok.Kol'
      '       , Ostatok.Price'
      '       , Ostatok.Price1'
      '       , Ostatok.Price2'
      '       , Ostatok.KolHold'
      '       , Tovar.NameTovar'
      '       , Ostatok.Percent1'
      '       , Ostatok.Percent2'
      '       , Ostatok.LastPriceIn'
      '       , Ostatok.AVGPriceIn'
      '       , Ostatok.EnableSkidka'
      '       , Company.NameCompany'
      '       , Tovar.SrokReal'
      '       , Ostatok.Price3'
      '       , Ostatok.Price4'
      '       , Ostatok.Price5'
      '       , Ostatok.Price6'
      '       , Ostatok.Price7'
      '       , Ostatok.Price8 '
      '       , Ostatok.Price9'
      '       , Ostatok.Price10'
      '       , Ostatok.Price13'
      '       , Ostatok.Price14'
      '       , Ostatok.Price15'
      '       , PriceForVeb.PriceVeb as PriceForVeb'
      '       , PriceForVeb.PriceInInst as PriceInInst'
      '       , Tovar.visible'
      '       , vt.VidName'
      '       , PriceForVeb.PriceOld'
      '       , PriceForVeb.PriceValidDate'
      '       , PriceForVeb.Currency'
      'from Ostatok,Tovar left outer join'
      '     Company on (Company.CompanyNo=Tovar.CompanyNo) left join  '
      
        '     PriceForVeb on  PriceForVeb.TovarNo = Tovar.TovarNo left jo' +
        'in'
      '     VidTov vt on vt.VidNo = Tovar.VidNo'
      'where (Ostatok.TovarNo=Tovar.TovarNo)  &_Kol &_OtdelNo &_flt'
      'order by &_order')
    CachedUpdates = True
    UpdateObject = UpdateSQL1
    AfterInsert = quOstatokAfterInsert
    BeforePost = quOstatokBeforePost
    BeforeDelete = quOstatokBeforeDelete
    OnCalcFields = quOstatokCalcFields
    Left = 24
    Top = 88
    MacroData = <
      item
        Name = '_Kol'
      end
      item
        Name = '_OtdelNo'
      end
      item
        Name = '_flt'
      end
      item
        Name = '_order'
        Value = 'Tovar.NameTovar'
      end>
    object quOstatokTovarNo: TSmallintField
      DisplayLabel = #1053#1086#1084#1077#1088' '#1090#1086#1074#1072#1088#1072
      FieldName = 'TovarNo'
    end
    object quOstatokNameTovar: TStringField
      FieldName = 'NameTovar'
      Size = 30
    end
    object quOstatokNameEnableSkidka: TStringField
      FieldKind = fkCalculated
      FieldName = 'NameEnableSkidka'
      Size = 1
      Calculated = True
    end
    object quOstatokPrice1: TFloatField
      FieldName = 'Price1'
      DisplayFormat = '0.00##'
    end
    object quOstatokPrice2: TFloatField
      FieldName = 'Price2'
      DisplayFormat = '0.00##'
    end
    object quOstatokKolHold: TFloatField
      FieldName = 'KolHold'
      DisplayFormat = '0.###'
    end
    object quOstatokLastPriceIn: TFloatField
      FieldName = 'LastPriceIn'
      DisplayFormat = '0.00##'
    end
    object quOstatokAVGPriceIn: TFloatField
      FieldName = 'AVGPriceIn'
      DisplayFormat = '0.00##'
    end
    object quOstatokEnableSkidka: TBooleanField
      FieldName = 'EnableSkidka'
    end
    object quOstatokNameCompany: TStringField
      FieldName = 'NameCompany'
      Size = 30
    end
    object quOstatokSrokReal: TSmallintField
      FieldName = 'SrokReal'
    end
    object quOstatokPrice3: TFloatField
      FieldName = 'Price3'
      DisplayFormat = '0.00##'
    end
    object quOstatokPercent1: TFloatField
      FieldName = 'Percent1'
      OnChange = quOstatokPercent1Change
      DisplayFormat = '0.00'
    end
    object quOstatokPercent2: TFloatField
      FieldName = 'Percent2'
      OnChange = quOstatokPercent2Change
      DisplayFormat = '0.00'
    end
    object quOstatokKol: TFloatField
      FieldName = 'Kol'
      DisplayFormat = '0.###'
    end
    object quOstatokPrice: TFloatField
      FieldName = 'Price'
      OnChange = quOstatokPriceChange
      DisplayFormat = '0.00##'
    end
    object quOstatokPrice4: TFloatField
      FieldName = 'Price4'
      DisplayFormat = '0.00##'
    end
    object quOstatokPrice5: TFloatField
      FieldName = 'Price5'
      DisplayFormat = '0.00##'
    end
    object quOstatokPrice6: TFloatField
      FieldName = 'Price6'
    end
    object quOstatokPrice7: TFloatField
      FieldName = 'Price7'
    end
    object quOstatokPrice8: TFloatField
      FieldName = 'Price8'
    end
    object quOstatokPrice9: TFloatField
      FieldName = 'Price9'
    end
    object quOstatokPrice10: TFloatField
      FieldName = 'Price10'
    end
    object quOstatokPrice13: TFloatField
      FieldName = 'Price13'
    end
    object quOstatokPrice14: TFloatField
      FieldName = 'Price14'
    end
    object quOstatokPrice15: TFloatField
      FieldName = 'Price15'
    end
    object quOstatokPriceForVeb: TFloatField
      FieldName = 'PriceForVeb'
    end
    object quOstatokPriceInInst: TFloatField
      FieldName = 'PriceInInst'
    end
    object quOstatokvisible: TBooleanField
      FieldName = 'visible'
    end
    object quOstatokVidName: TStringField
      FieldName = 'VidName'
      Size = 30
    end
    object quOstatokPriceOld: TFloatField
      DisplayLabel = #1057#1090#1072#1088#1072#1103' '#1094#1077#1085#1072
      FieldName = 'PriceOld'
    end
    object quOstatokPriceValidDate: TDateTimeField
      DisplayLabel = #1044#1072#1090#1072' '#1072#1082#1090#1091#1072#1083#1100#1085#1086#1089#1090#1080
      FieldName = 'PriceValidDate'
    end
    object quOstatokCurrency: TStringField
      FieldName = 'Currency'
      Size = 5
    end
    object quOstatokCurrencyCode: TStringField
      DisplayLabel = #1042#1072#1083#1102#1090#1072
      DisplayWidth = 30
      FieldKind = fkLookup
      FieldName = 'CurrencyCode'
      LookupDataSet = dmDataModule.quCurrency
      LookupKeyFields = 'L_CODE'
      LookupResultField = 'NAME'
      KeyFields = 'Currency'
      Lookup = True
    end
  end
  object dsOstatok: TDataSource
    DataSet = quOstatok
    Left = 88
    Top = 88
  end
  object UpdateSQL1: TMSUpdateSQL
    InsertSQL.Strings = (
      'declare'
      '    @cnt int'
      '  , @Edit_user  varchar(50)'
      '  , @Edit_host_name varchar(50)'
      '  , @Old_TovarNo int'
      ''
      ' select @Edit_user = suser_sname(),'
      '        @Edit_host_name = HOST_NAME ()'
      ''
      'set @Old_TovarNo = :OLD_TovarNo'
      ''
      'insert into Ostatok'
      
        '  (Kol, Price, Price1, Price2, KolHold, Percent1, Percent2, Last' +
        'PriceIn, '
      '   AVGPriceIn, EnableSkidka, Price3, Price4, Price5, Price6, '
      '   Price7,Price8,Price9,Price10,Price13,Price14,Price15)'
      'values'
      
        '  (:Kol, :Price, :Price1, :Price2, :KolHold, :Percent1, :Percent' +
        '2, :LastPriceIn, '
      
        '   :AVGPriceIn, :EnableSkidka, :Price3, :Price4, :Price5, :Price' +
        '6, '
      
        '   :Price7, :Price8, :Price9, :Price10, :Price13, :Price14,:Pric' +
        'e15)'
      ''
      'select @cnt = count(*) from PriceForVeb where TovarNo = :TovarNo'
      ''
      'if @cnt = 0'
      'insert into PriceForVeb'
      
        '  (TovarNo, PriceVeb, PriceInInst, PriceOld, PriceValidDate, Cur' +
        'rency)'
      
        ' values(@Old_TovarNo, :PriceForVeb, :PriceInInst, :PriceOld, :Pr' +
        'iceValidDate, :Currency)'
      ''
      
        'if isnull(:Price,0) + isnull(:Price1,0) + isnull(:Price2,0) + is' +
        'null(:Price3,0) + isnull(:Price4,0) + isnull(:Price5,0) + isnull' +
        '(:Price6,0) + isnull(:Price7,0) +'
      
        '   isnull(:Price8,0) + isnull(:Price9,0) + isnull(:Price10,0) + ' +
        'isnull(:Price13,0) + isnull(:Price14,0) + isnull(:Price15,0) + i' +
        'snull(:PriceForVeb,0) + isnull(:PriceInInst,0) <>'
      
        '   (select isnull(o.Price,0) + isnull(o.Price1,0) + isnull(o.Pri' +
        'ce2,0) + isnull(o.Price3,0) + isnull(o.Price4,0) + isnull(o.Pric' +
        'e5,0) + isnull(o.Price6,0) + isnull(o.Price7,0) +'
      
        '           isnull(o.Price8,0) + isnull(o.Price9,0) + isnull(o.Pr' +
        'ice10,0) + isnull(o.Price13,0) + isnull(o.Price14,0) + isnull(o.' +
        'Price15,0) + isnull(pfv.PriceVeb,0) + isnull(pfv.PriceInInst,0) ' +
        '+'
      '           isnull(o.AvgPriceIn,0) + isnull (o.LastPriceIn,0) '
      
        '     from Ostatok o left join PriceForVeb pfv on pfv.TovarNo = o' +
        '.TovarNo'
      
        '      where ((o.TovarNo = @Old_TovarNo) or (pfv.TovarNo = @Old_T' +
        'ovarNo))'
      ''
      
        'insert into HistoriPrice (TovarNo, NameTovar, DateChangePrice, V' +
        'idName, Price, Price1,'#9'Price2,'#9'Price3, Price4, Price5, Price6, P' +
        'rice7,'
      
        '                          Price8, Price9, Price10, Price13, Pric' +
        'e14, Price15, PriceVeb, PriceInInst, Edit_user, Edit_host_name, ' +
        'AvgPriceIn, LastPriceIn, Currency)'
      ' values (  :TovarNo'
      
        '         , (select NameTovar from Tovar where TovarNo = :TovarNo' +
        ') '
      '         , getdate ()'
      '         , :VidName'
      '         , :Price'
      '         , :Price1'
      '         , :Price2'
      '         , :Price3'
      '         , :Price4'
      '         , :Price5'
      '         , :Price6'
      '         , :Price7'
      '         , :Price8'
      '         , :Price9'
      '         , :Price10'
      '         , :Price13'
      '         , :Price14'
      '         , :Price15'
      '         , :PriceForVeb'
      '         , :PriceInInst'
      '         , @Edit_user'
      #9' , @Edit_host_name'
      '         , :AvgPriceIn'
      '         , :LastPriceIn'
      '         , :Currency)')
    DeleteSQL.Strings = (
      'declare'
      '    @Edit_user  varchar(50)'
      '  , @Edit_host_name varchar(50)'
      '  , @Old_TovarNo int'
      ''
      ' select @Edit_user = suser_sname(),'
      '        @Edit_host_name = HOST_NAME ()'
      ''
      'set @Old_TovarNo = :OLD_TovarNo'
      ''
      'delete from Ostatok'
      'where'
      '  TovarNo = @Old_TovarNo'
      ''
      'delete from PriceForVeb'
      'where'
      '  TovarNo = @Old_TovarNo'
      ''
      
        'insert into HistoriPrice (TovarNo, NameTovar, DateChangePrice, V' +
        'idName, Price, Price1,'#9'Price2,'#9'Price3, Price4, Price5, Price6, P' +
        'rice7,'
      
        '                          Price8, Price9, Price10, Price13, Pric' +
        'e14, Price15, PriceVeb, PriceInInst, Edit_user, Edit_host_name, ' +
        'AvgPriceIn, LastPriceIn, Currency)'
      ' values (  @Old_TovarNo'
      
        '         , (select NameTovar from Tovar where TovarNo = @Old_Tov' +
        'arNo) '
      '         , getdate ()'
      '         , :VidName'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , Null'
      '         , @Edit_user'
      #9' , @Edit_host_name'
      '         , Null'
      '         , Null'
      '         , Null)')
    ModifySQL.Strings = (
      'declare'
      '    @Edit_user  varchar(50)'
      '  , @Edit_host_name varchar(50)'
      '  , @Old_TovarNo int'
      ''
      ' select @Edit_user = suser_sname(),'
      '        @Edit_host_name = HOST_NAME ()'
      ''
      'set @Old_TovarNo = :OLD_TovarNo'
      ''
      ''
      
        'if isnull(:Price,0) + isnull(:Price1,0) + isnull(:Price2,0) + is' +
        'null(:Price3,0) + isnull(:Price4,0) + isnull(:Price5,0) + isnull' +
        '(:Price6,0) + isnull(:Price7,0) +'
      
        '   isnull(:Price8,0) + isnull(:Price9,0) + isnull(:Price10,0) + ' +
        'isnull(:Price13,0) + isnull(:Price14,0) + isnull(:Price15,0) + i' +
        'snull(:PriceForVeb,0) + isnull(:PriceInInst,0) <>'
      ''
      
        '   (select isnull(o.Price,0) + isnull(o.Price1,0) + isnull(o.Pri' +
        'ce2,0) + isnull(o.Price3,0) + isnull(o.Price4,0) + isnull(o.Pric' +
        'e5,0) + isnull(o.Price6,0) + isnull(o.Price7,0) +'
      
        '           isnull(o.Price8,0) + isnull(o.Price9,0) + isnull(o.Pr' +
        'ice10,0) + isnull(o.Price13,0) + isnull(o.Price14,0) + isnull(o.' +
        'Price15,0) + isnull(pfv.PriceVeb,0) + isnull(pfv.PriceInInst,0)+'
      '           isnull(o.AvgPriceIn,0) + isnull (o.LastPriceIn,0) '
      
        '     from Ostatok o left join PriceForVeb pfv on pfv.TovarNo = o' +
        '.TovarNo'
      
        '      where o.TovarNo = @Old_TovarNo or pfv.TovarNo = @Old_Tovar' +
        'No)'
      
        '   or (:Currency <> (select Currency from PriceForVeb where Tova' +
        'rNo = @Old_TovarNo))'
      ''
      
        'insert into HistoriPrice (TovarNo, NameTovar, DateChangePrice, V' +
        'idName, Price, Price1,'#9'Price2,'#9'Price3, Price4, Price5, Price6, P' +
        'rice7,'
      
        '                          Price8, Price9, Price10, Price13, Pric' +
        'e14, Price15, PriceVeb, PriceInInst, Edit_user, Edit_host_name, ' +
        'AvgPriceIn, LastPriceIn, Currency)'
      ' values (  :TovarNo'
      
        '         , (select NameTovar from Tovar where TovarNo = @Old_Tov' +
        'arNo) '
      '         , getdate ()'
      '         , :VidName'
      '         , :Price'
      '         , :Price1'
      '         , :Price2'
      '         , :Price3'
      '         , :Price4'
      '         , :Price5'
      '         , :Price6'
      '         , :Price7'
      '         , :Price8'
      '         , :Price9'
      '         , :Price10'
      '         , :Price13'
      '         , :Price14'
      '         , :Price15'
      '         , :PriceForVeb'
      '         , :PriceInInst'
      '         , @Edit_user'
      #9' , @Edit_host_name'
      '         , :AvgPriceIn'
      '         , :LastPriceIn'
      '         , :Currency)'
      ''
      'update Ostatok'
      'set'
      '  Kol = :Kol,'
      '  Price = :Price,'
      '  Price1 = :Price1,'
      '  Price2 = :Price2,'
      '  KolHold = :KolHold,'
      '  Percent1 = :Percent1,'
      '  Percent2 = :Percent2,'
      '  LastPriceIn = :LastPriceIn,'
      '  AVGPriceIn = :AVGPriceIn,'
      '  EnableSkidka = :EnableSkidka,'
      '  Price3 = :Price3,'
      '  Price4 = :Price4,'
      '  Price5 = :Price5,'
      '  Price6 = :Price6,'
      '  Price7 = :Price7,'
      '  Price8 = :Price8,'
      '  Price9 = :Price9,'
      '  Price13 = :Price13,'
      '  Price14 = :Price14,'
      '  Price15 = :Price15,'
      '  Price10 = :Price10'
      'where'
      '  TovarNo = @Old_TovarNo'
      ''
      'update PriceForVeb'
      'set'
      '  PriceVeb = :PriceForVeb,'
      '  PriceInInst = :PriceInInst,'
      '  PriceOld = :PriceOld, '
      '  Currency = :Currency'
      'where'
      '  TovarNo = @Old_TovarNo')
    Left = 168
    Top = 88
  end
  object spReCalcPriceIn: TMSStoredProc
    StoredProcName = 'sp_ReCalcPriceIn;1'
    Connection = dmDataModule.DB
    SQL.Strings = (
      '{:RETURN_VALUE = CALL sp_ReCalcPriceIn;1}')
    Left = 640
    Top = 328
    ParamData = <
      item
        DataType = ftInteger
        Name = 'RETURN_VALUE'
        ParamType = ptResult
      end>
  end
  object sp_force_rest: TMSStoredProc
    StoredProcName = 'Pr_correct_errors'
    Connection = dmDataModule.DB
    Left = 536
    Top = 328
  end
  object ActionList1: TActionList
    Images = dmDataModule.ImageListToolBar
    Left = 144
    Top = 208
    object ActionFind: TAction
      ImageIndex = 20
      ShortCut = 16454
      OnExecute = ActionFindExecSQL
    end
  end
end
